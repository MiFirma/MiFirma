<%= content_for :bodyclass do %>como-funciona<% end %> 
<% content_for :title, "Proceso de firma electrónica"%>

<%- content_for(:head) do -%>
<%= javascript_include_tag "Cliente_Firma_3.3.1_u5/constantes.js", "Cliente_Firma_3.3.1_u5/common-js/instalador.js" -%>
<%- end -%>

<script type="text/javascript">

	cargarAppletFirma('MEDIA');
	
	clienteFirma.initialize();
	
	document.getElementById("Espera").style.display = "none";
	
	function doSign() {
		
		clienteFirma.initialize();
						
		var dataB64 = document.getElementById("xmlOCE2").value ;
		
		clienteFirma.setCertFilter('{SUBJECT.DN#NOT_MATCHES#{".*(AUTENTICACIÓN).*"}}}');
		clienteFirma.setSignatureFormat("XAdES Detached");
		clienteFirma.setSignatureAlgorithm("sha1WithRsaEncryption");
		clienteFirma.setSignatureMode("IMPLICIT");
		
		clienteFirma.setData(dataB64);
		clienteFirma.sign();
		
		if(!clienteFirma.isError()) {
			document.forms[0].xmlSigned2.value = clienteFirma.getSignatureBase64Encoded();
			document.forms[0].submit();
		}
			else {
				alert("No se ha podido firmar: "+clienteFirma.getErrorMessage());
				return false;
		}

	}
	
</script>

	
